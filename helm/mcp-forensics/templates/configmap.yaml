apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "mcp-forensics.fullname" . }}-config
  labels:
    {{- include "mcp-forensics.labels" . | nindent 4 }}
data:
  # Application configuration
  app.yaml: |
    environment: {{ .Values.env | first | default (dict "value" "production") | dig "value" "production" }}
    log_level: INFO
    
    # API Settings
    api:
      host: 0.0.0.0
      port: {{ .Values.service.port }}
      workers: 4
      cors_origins:
        - "*"
    
    # Database
    database:
      pool_size: 10
      max_overflow: 20
      pool_timeout: 30
    
    # Redis
    redis:
      host: {{ include "mcp-forensics.redis.host" . }}
      port: 6379
      db: 0
    
    # Evidence Storage
    evidence:
      base_path: {{ .Values.persistence.mountPath }}
      max_file_size: 100MB
      allowed_extensions:
        - .csv
        - .json
        - .xml
        - .txt
        - .log
        - .dmp
        - .mem
    
    # Forensic Tools
    tools:
      sparrow_path: /opt/forensics-tools/Sparrow
      hawk_enabled: true
      yara_rules_path: /opt/forensics-tools/yara-rules
      loki_path: /opt/forensics-tools/Loki
    
    # LLM Provider
    llm:
      default_provider: {{ .Values.llmProvider.config.defaultProvider }}
      timeout: 60
      max_tokens: 4096
      providers:
        ollama:
          url: {{ .Values.llmProvider.config.ollamaUrl }}
        lmstudio:
          url: {{ .Values.llmProvider.config.lmstudioUrl }}
    
    # Security
    security:
      rbac_enabled: true
      api_key_required: true
      rate_limit:
        enabled: true
        requests_per_minute: 60
    
    # Observability
    observability:
      metrics_enabled: {{ .Values.metrics.enabled }}
      tracing_enabled: true
      otel_exporter: "jaeger"
