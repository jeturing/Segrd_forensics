# üìã MCP Kali Forensics v4.3 - Release Notes

## üöÄ Resumen de Cambios

La versi√≥n 4.3 introduce un sistema modular completo con auto-generaci√≥n de c√≥digo, nuevos m√≥dulos de an√°lisis forense y un proveedor LLM agn√≥stico.

## ‚ú® Nuevas Caracter√≠sticas

### üß† LLM Provider Agn√≥stico
- **Auto-detecci√≥n de modelos** desde LM Studio y Ollama
- **Cambio din√°mico de modelo** sin reiniciar el backend
- **Cach√© de modelos** con TTL configurable (5 minutos)
- **Fallback autom√°tico** entre proveedores
- **An√°lisis forense con LLM** integrado en hunting y reports

### üéØ Threat Hunting Module
- **7+ queries predefinidas** (KQL, OSQuery, Sigma)
- **Categor√≠as MITRE ATT&CK** completas
- **Ejecuci√≥n en background** con resultados as√≠ncronos
- **An√°lisis LLM** de resultados de hunting
- **Queries personalizadas** guardables
- **Batch execution** para m√∫ltiples hunts

### ‚è±Ô∏è Timeline Module
- **Eventos con correlaci√≥n** autom√°tica
- **Importaci√≥n desde herramientas** (Loki, YARA, M365)
- **Exportaci√≥n JSON/CSV/HTML**
- **Gr√°ficos de timeline** con m√∫ltiples resoluciones
- **Marcado de eventos clave**
- **Filtros por tipo, severidad, fuente**

### üìÑ Reports Module
- **Generaci√≥n PDF/HTML/JSON/Markdown**
- **Templates predefinidos**: Technical, Executive, Evidence, Incident
- **Templates personalizados** con secciones configurables
- **Resumen ejecutivo con LLM** autom√°tico
- **Preview antes de generar**
- **Batch generation** para m√∫ltiples tipos

### üì¶ Module Registry & Auto-Generation
- **modules.json** como fuente de verdad
- **Validaci√≥n de m√≥dulos** autom√°tica
- **Generaci√≥n de c√≥digo**:
  - Routes FastAPI
  - Services Python
  - Pages React
- **Gesti√≥n de dependencias** entre m√≥dulos
- **Categor√≠as y endpoints** documentados

## üìä Estad√≠sticas

| M√©trica | Valor |
|---------|-------|
| M√≥dulos Registrados | 11 |
| Endpoints Totales | 80+ |
| Categor√≠as | 8 |
| Queries de Hunting | 7 |
| Templates de Reportes | 4 |

## üîó Nuevos Endpoints

### Hunting (`/hunting`)
```
GET  /                    - Estado del servicio
GET  /queries             - Listar queries
GET  /queries/{id}        - Obtener query
POST /execute             - Ejecutar hunt
POST /execute/custom      - Hunt personalizado
GET  /results/{case_id}   - Resultados por caso
POST /queries/save        - Guardar query
GET  /categories          - Categor√≠as MITRE
GET  /mitre               - Cobertura MITRE
POST /batch               - Ejecutar batch
```

### Timeline (`/timeline`)
```
GET  /                    - Estado del servicio
GET  /{case_id}           - Timeline de caso
POST /events              - Agregar evento
POST /events/bulk         - Bulk add eventos
GET  /events/{id}         - Obtener evento
PUT  /events/{id}         - Actualizar evento
DEL  /events/{id}         - Eliminar evento
POST /correlate           - Correlacionar
GET  /{case_id}/summary   - Resumen
GET  /{case_id}/graph     - Datos gr√°fico
POST /{case_id}/import    - Importar
GET  /{case_id}/export    - Exportar
```

### Reports (`/reports`)
```
GET  /                    - Estado del servicio
POST /generate            - Generar reporte
GET  /case/{case_id}      - Reportes de caso
GET  /{report_id}         - Obtener reporte
GET  /{id}/status         - Estado generaci√≥n
GET  /{id}/download       - Descargar
POST /{id}/regenerate     - Regenerar
GET  /templates           - Templates
POST /templates           - Crear template
GET  /sections            - Secciones
POST /preview             - Preview
POST /batch               - Batch generate
```

### Module Registry (`/modules`)
```
GET  /                    - Info registry
GET  /list                - Listar m√≥dulos
GET  /{module_id}         - Detalle m√≥dulo
GET  /{id}/endpoints      - Endpoints m√≥dulo
GET  /all/endpoints       - Todos endpoints
GET  /validate/all        - Validar todos
POST /{id}/generate       - Generar c√≥digo
GET  /categories          - Categor√≠as
GET  /dependencies/{id}   - Dependencias
```

## üõ†Ô∏è Archivos Nuevos

```
/modules.json                    - Registro de m√≥dulos
/modules.schema.json             - Schema JSON
/core/module_registry.py         - Auto-generaci√≥n
/core/__init__.py                - Exports
/api/routes/hunting.py           - Rutas hunting
/api/routes/timeline.py          - Rutas timeline
/api/routes/reports.py           - Rutas reports
/api/routes/modules.py           - Rutas registry
/api/services/hunting.py         - Servicio hunting (actualizado)
/api/services/timeline.py        - Servicio timeline (actualizado)
/api/services/reports.py         - Servicio reports (actualizado)
```

## üîß Configuraci√≥n

### Variables de Entorno
```env
# LLM Provider
LM_STUDIO_URL=http://100.101.115.5:2714
OLLAMA_URL=http://localhost:11434
LLM_PROVIDER=lm_studio

# Reports
REPORTS_OUTPUT_DIR=forensics-evidence/reports
PDF_ENGINE=weasyprint
```

## üìà Pr√≥ximos Pasos (v4.4)

1. **Frontend Components** para nuevos m√≥dulos
2. **WebSocket** para actualizaciones en tiempo real
3. **Playbooks SOAR** con integraci√≥n LLM
4. **Graph Database** para correlaciones
5. **API Rate Limiting** y throttling

## üêõ Fixes

- Corregido manejo de errores en servicios async
- Mejorado logging con emojis para filtrado r√°pido
- Agregado timeout configurable para herramientas externas

---

**Fecha**: 2025-12-08  
**Versi√≥n**: 4.3.0  
**Autor**: MCP Kali Forensics Team
